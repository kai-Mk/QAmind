# Practice 4: 異常系・例外テスト

## 学習目標

- 「異常系テスト」の重要性を理解する
- `toThrow` / `toThrowError` を使って例外をテストできるようになる
- 正常系だけでなく、エラーケースも考慮したテスト設計ができるようになる

## 異常系テストとは？

正常な入力に対するテスト（正常系）だけでは不十分です。不正な入力や予期しない状態に対して、プログラムが適切にエラーを返すかを確認するのが **異常系テスト** です。

### なぜ異常系が大事？

- ユーザーは予想外の操作をする
- 外部データは常に正しいとは限らない
- エラーハンドリングの不備はセキュリティ問題につながる

### テスト設計の観点

| 種類   | テストする内容                   |
| ------ | -------------------------------- |
| 正常系 | 期待通りの入力で正しい結果が返る |
| 異常系 | 不正な入力でエラーが発生する     |
| 境界値 | ギリギリの値で正しく動作する     |

## vitestの構文: `toThrow`

関数がエラーを投げることを検証します。**注意**: `expect` に渡すのは関数の実行結果ではなく、**関数そのもの**です。

```ts
// NG: これだとエラーがキャッチされない
expect(divide(10, 0)).toThrow()

// OK: 関数をラップして渡す
expect(() => divide(10, 0)).toThrow()
```

### `toThrowError` でメッセージを検証

```ts
expect(() => divide(10, 0)).toThrowError('0で割ることはできません')
expect(() => divide(10, 0)).toThrowError(/0で割る/) // 正規表現もOK
```

## 演習

`practices/practice4/target.ts` に定義されている関数に対して、正常系と異常系の両方のテストを書いてみましょう。

`practices/practice4/target.test.ts` を開いて、エラーケースを漏れなくテストしてください。

### ポイント

- まず「どんな入力がエラーになるか」を洗い出す
- `toThrow` では関数を `() =>` でラップすることを忘れない
- エラーメッセージの内容も検証する
